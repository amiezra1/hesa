<!doctype html>
<html lang="he" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>רישום נוסע – היסע למילואים</title>
  <meta name="color-scheme" content="light">

  <style>
    :root{
      --radius:16px; 
      --border:#e2e8f0; 
      --bg:#f8fafc; 
      --text:#0f172a; 
      --muted:#64748b;
      --brand:#2563eb; 
      --brand-light:#3b82f6;
      --accent:#06b6d4; 
      --ok:#10b981; 
      --err:#ef4444;
      --card:#ffffff; 
      --shadow:0 1px 3px rgba(0,0,0,.05), 0 10px 40px rgba(0,0,0,.03);
      --shadow-lg:0 20px 60px rgba(0,0,0,.08);
    }
    *{box-sizing:border-box; margin:0; padding:0}
    html,body{height:100%}
    body{
      font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,'Helvetica Neue',Arial,sans-serif;
      margin:0;
      background:linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color:var(--text);
      line-height:1.6;
    }
    .wrap{max-width:920px; margin-inline:auto; padding:32px 20px}
    
    .header{
      border-radius:24px; 
      padding:40px 32px; 
      margin:0 0 28px;
      background:var(--card);
      border:1px solid var(--border);
      box-shadow:var(--shadow-lg);
      position:relative;
      overflow:hidden;
    }
    .header::before{
      content:'';
      position:absolute;
      top:0;
      left:0;
      right:0;
      height:4px;
      background:linear-gradient(90deg, var(--brand), var(--accent));
    }
    .badge{
      display:inline-flex; 
      gap:8px; 
      align-items:center; 
      font-size:13px; 
      font-weight:600;
      color:var(--brand); 
      background:rgba(37,99,235,0.08); 
      border:1px solid rgba(37,99,235,0.15); 
      padding:8px 16px; 
      border-radius:999px;
      margin-bottom:16px;
    }
    h1{
      margin:12px 0 12px; 
      font-size:32px; 
      font-weight:700;
      background:linear-gradient(135deg, var(--brand), var(--accent));
      -webkit-background-clip:text;
      -webkit-text-fill-color:transparent;
      background-clip:text;
    }
    .sub{
      color:var(--muted); 
      margin:0 0 20px;
      font-size:15px;
      line-height:1.7;
    }
    .kpi{
      display:flex; 
      gap:12px; 
      flex-wrap:wrap;
      align-items:center; 
      font-size:13px; 
      margin-top:20px;
    }
    .chip{
      padding:8px 14px; 
      border-radius:12px; 
      background:var(--bg); 
      border:1px solid var(--border); 
      font-size:13px;
      color:var(--muted);
      font-weight:500;
      transition:all 0.2s ease;
    }
    .chip:hover{
      background:#fff;
      box-shadow:0 2px 8px rgba(0,0,0,.06);
    }
    
    .card{
      background:var(--card); 
      border:1px solid var(--border); 
      border-radius:var(--radius); 
      padding:32px; 
      margin:20px 0;
      box-shadow:var(--shadow);
      transition:box-shadow 0.3s ease;
    }
    .card:hover{
      box-shadow:var(--shadow-lg);
    }
    
    .grid{display:grid; grid-template-columns:1fr; gap:20px}
    @media(min-width:720px){ .grid{grid-template-columns:1fr 1fr} }
    
    .row{display:flex; gap:10px; flex-wrap:wrap; align-items:center}
    
    label{
      font-size:14px; 
      font-weight:600;
      color:var(--text); 
      display:block; 
      margin-bottom:8px;
    }
    
    input,select,button,textarea{
      font:inherit; 
      padding:14px 16px; 
      border:2px solid var(--border); 
      border-radius:12px; 
      width:100%; 
      background:#fff; 
      color:var(--text);
      transition:all 0.2s ease;
      font-size:15px;
    }
    input::placeholder, textarea::placeholder{
      color:#94a3b8;
    }
    input:hover, select:hover, textarea:hover{
      border-color:#cbd5e1;
    }
    input:focus,select:focus,textarea:focus{
      outline:none; 
      border-color:var(--brand); 
      box-shadow:0 0 0 4px rgba(37,99,235,.1);
    }
    textarea{
      resize:vertical; 
      min-height:100px;
      line-height:1.6;
    }
    
    .helper{
      font-size:13px; 
      color:var(--muted); 
      margin-top:6px;
      font-style:italic;
    }
    
    button{
      cursor:pointer; 
      border:0; 
      padding:16px 32px; 
      border-radius:12px; 
      font-weight:700;
      font-size:16px;
      background:linear-gradient(135deg, var(--brand), var(--brand-light)); 
      color:#fff;
      transition:all 0.2s ease;
      box-shadow:0 4px 14px rgba(37,99,235,.3);
      text-transform:none;
    }
    button:hover{
      transform:translateY(-2px);
      box-shadow:0 6px 20px rgba(37,99,235,.4);
    }
    button:active{
      transform:translateY(0);
    }
    
    .actions{
      display:flex; 
      gap:16px; 
      flex-wrap:wrap; 
      align-items:center; 
      justify-content:flex-start;
      margin-top:24px;
    }
    
    hr{
      border:0; 
      height:1px; 
      background:var(--border); 
      margin:24px 0;
    }
    
    .status{
      min-height:1.6em;
      font-weight:600;
      font-size:15px;
    }
    .ok{color:var(--ok)}
    .err{color:var(--err)}
    .muted{color:var(--muted)}
    
    footer{
      margin:32px 0; 
      padding:24px;
      font-size:13px; 
      color:#fff; 
      text-align:center;
      background:rgba(255,255,255,0.1);
      border-radius:16px;
      backdrop-filter:blur(10px);
      line-height:1.8;
    }
    
    .info-card h3{
      margin:0 0 16px; 
      font-size:20px;
      font-weight:700;
      color:var(--text);
    }
    .info-card ol{
      margin:12px 0 16px 24px; 
      line-height:1.9;
      color:var(--muted);
    }
    .info-card ol li{
      margin-bottom:8px;
      padding-right:8px;
    }
    .tooltip{
      font-size:13px; 
      color:var(--brand);
      background:rgba(37,99,235,0.08);
      padding:12px 16px;
      border-radius:12px;
      border-right:3px solid var(--brand);
      margin-top:16px;
      font-weight:500;
    }
    
    input[type="checkbox"]{
      width:20px;
      height:20px;
      margin-left:8px;
      cursor:pointer;
      accent-color:var(--brand);
    }
    
    .privacy-row{
      display:flex;
      align-items:center;
      gap:8px;
      padding:16px;
      background:var(--bg);
      border-radius:12px;
      margin-top:20px;
    }
    .privacy-row label{
      margin:0;
      font-size:14px;
      font-weight:500;
      cursor:pointer;
    }
    
    @media(max-width:720px){
      .wrap{padding:20px 16px}
      .header{padding:28px 24px}
      h1{font-size:26px}
      .card{padding:24px}
      .kpi{gap:8px}
    }
  </style>
</head>
<body>
  <div class="wrap">

    <!-- Header -->
    <section class="header">
      <div class="badge">🎯 טופס רישום נוסע • היסע למילואים</div>
      <h1>בקשת נסיעה – נוסע</h1>
      <p class="sub">בחרו <strong>אזור יעד</strong> (חובה) והוסיפו <strong>עיר מדויקת</strong> רק אם נחוץ. הגדירו חלון זמן סביר להמתנה.</p>
      <div class="kpi">
        <span class="chip">⌛ מילוי ~ 30–45 שניות</span>
        <span class="chip">🔒 פרטי קשר נחשפים לאחר התאמה</span>
        <span class="chip">🕒 חלון זמן ברירת מחדל: עכשיו עד +120 דק׳</span>
      </div>
    </section>

    <!-- Form -->
    <form id="riderForm" class="card" novalidate>
      <div class="grid">
        <div>
          <label for="ids">תעודת זהות *</label>
          <input id="ids" name="ids" inputmode="numeric" pattern="[0-9]*" maxlength="9" placeholder="תעודת זהות" oninput="this.value = this.value.replace(/[^0-9]/g, '')" required/>
        </div>
        <div>
          <label for="name">שם מלא *</label>
          <input id="name" name="name" placeholder="שם פרטי ושם משפחה" autocomplete="name" required />
        </div>
        <div>
          <label for="phone">טלפון נייד (05XXXXXXXX) *</label>
          <input id="phone" name="phone" placeholder="לדוגמה: 0521234567" autocomplete="tel" pattern="[0-9]*" inputmode="numeric" maxlength="10" oninput="this.value = this.value.replace(/[^0-9]/g, '')" required />
        </div>

        <div>
          <label for="origin">תחנת מוצא *</label>
          <select id="origin" name="origin" required>
            <option value="">בחרו תחנת מוצא</option>
            <option>צומת צקל"ג</option>
            <option>שדה תימן</option>
            <option>באר שבע צפון</option>
            <option>צומת בית קמה</option>
            <option>נבטים</option>
            <option>אוגדה 80</option>
            <option>ירוחם</option>
            <option>שיזפון</option>
            <option>סיירים</option>
          </select>
          <div class="helper">ניתן להרחיב לפי התחנות שלכם.</div>
        </div>

        <div>
          <label for="zone">אזור יעד (חובה) *</label>
          <select id="zone" name="zone" required>
            <option value="">בחרו אזור</option>
            <option>צפון</option>
            <option>חיפה והקריות</option>
            <option>עמק יזרעאל / ואדי ערה</option>
            <option>שרון</option>
            <option>גוש דן</option>
            <option>שפלה</option>
            <option>ירושלים והסביבה</option>
            <option>דרום מרכזי</option>
            <option>ב"ש והנגב הצפוני</option>
            <option>ערבה/דרום רחוק</option>
          </select>
        </div>

        <div>
          <label for="city">עיר מדויקת (אופציונלי)</label>
          <input id="city" name="city" placeholder="לדוגמה: חולון, באר שבע..." />
          <div class="helper">מלאו רק אם חשוב לדייק בתוך האזור.</div>
        </div>

        <div>
          <label for="earliest">הכי מוקדם *</label>
          <input id="earliest" name="earliest" type="datetime-local" required />
        </div>
        <div>
          <label for="latest">הכי מאוחר *</label>
          <input id="latest" name="latest" type="datetime-local" required />
          <div class="helper">ברירת מחדל: כעת עד +120 דק׳. ניתן לשנות.</div>
        </div>

        <div class="grid" style="grid-template-columns:1fr;">
          <div>
            <label for="notes">הערות (ציוד, סטייה אפשרית, נגישות)</label>
            <textarea id="notes" name="notes" placeholder="לדוגמה: תיק גדול / אעדיף עצירה בתחנת רכבת חולון"></textarea>
          </div>
        </div>
      </div>

      <div class="privacy-row">
        <input type="checkbox" id="privacy" required>
        <label for="privacy">אני מאשר/ת שמירה על פרטיות.</label>
      </div>

      <div class="actions">
        <button type="submit">שליחת בקשה</button>
        <span id="status" class="status muted"></span>
      </div>
    </form>

    <!-- Info -->
    <section class="card info-card">
      <h3>איך זה עובד?</h3>
      <ol>
        <li>ממלאים פרטים ושולחים.</li>
        <li>המערכת מחפשת נהגים מתאימים לפי אזור/זמן/מקומות פנויים.</li>
        <li>לאחר התאמה תקבלו קישור WhatsApp מוכן לתיאום מול הנהג.</li>
      </ol>
      <div class="tooltip">💡 טיפ: בחרו אזור רחב; עיר רק אם קריטי.</div>
    </section>

    <footer>
      © היסע למילואים – לצורכי מילואים | פרטי קשר נחשפים רק לאחר התאמה<br>
      לשאלות ניתן לפנות למוקד המילואים בטלפון 1111 שלוחה 4 => 1 => 3
    </footer>
  </div>

  <script>
    /** שים כאן את קישור ה-Apps Script Web App שלך */
    const API_URL = "YOUR_APPS_SCRIPT_WEB_APP_URL";

    /** קביעת ברירת מחדל לחלון זמן: עכשיו עד +120 דקות */
    (function presetWindow(){
      const now = new Date();
      const latest = new Date(now.getTime() + 120*60000);
      const pad = n => String(n).padStart(2,'0');
      const toLocal = d => d.getFullYear()+"-"+pad(d.getMonth()+1)+"-"+pad(d.getDate())+"T"+pad(d.getHours())+":"+pad(d.getMinutes());
      document.getElementById('earliest').value = toLocal(now);
      document.getElementById('latest').value   = toLocal(latest);
    })();

    /** נירמול טלפון ישראלי ל-972 */
    function normalizeIL(phone){
      if(!phone) return "";
      let p = (""+phone).replace(/\D/g,"");
      if(p.startsWith("0")) p = "972" + p.slice(1);
      return p;
    }

    /** הודעת סטטוס */
    function toast(msg, ok=false){
      const el = document.getElementById('status');
      el.textContent = msg;
      el.className = "status " + (ok ? "ok" : "err");
    }

    /** ולידציה בסיסית */
    function validate(){
      const required = ["name","phone","origin","zone","earliest","latest","privacy"];
      for(const id of required){
        const el = document.getElementById(id);
        if(id==="privacy"){
          if(!el.checked){ toast("יש לאשר את תנאי הפרטיות.", false); return false; }
          continue;
        }
        if(!el || !el.value.trim()){ toast("נא למלא את כל השדות החיוניים המסומנים *", false); return false; }
      }
      const phone = document.getElementById('phone').value.trim();
      if(!/^0?5\d{8}$/.test(phone)){ toast("טלפון לא תקין. פורמט: 05XXXXXXXX", false); return false; }

      const eVal = document.getElementById('earliest').value;
      const lVal = document.getElementById('latest').value;
      const e = new Date(eVal), l = new Date(lVal);
      if(!(e instanceof Date) || !(l instanceof Date) || isNaN(e.getTime()) || isNaN(l.getTime())){
        toast("חלון זמן לא תקין.", false); return false;
      }
      if(l <= e){ toast("'הכי מאוחר' חייב להיות אחרי 'הכי מוקדם'.", false); return false; }
      // חלון סביר עד 8 שעות (מניעת טעויות)
      if((l - e) > 8*60*60000){ toast("חלון זמן גדול מדי (מקסימום 8 שעות).", false); return false; }

      return true;
    }

    /** שליחת טופס */
    document.getElementById('riderForm').addEventListener('submit', async (e)=>{
      e.preventDefault();
      if(!validate()) return;

      const payload = {
        role: "rider",
        name: document.getElementById('name').value.trim(),
        phone: normalizeIL(document.getElementById('phone').value.trim()),
        ids: document.getElementById('ids').value.trim(),
        origin: document.getElementById('origin').value,
        destinationZone: document.getElementById('zone').value,
        preciseCity: document.getElementById('city').value.trim(), // אופציונלי
        earliest: document.getElementById('earliest').value,
        latest: document.getElementById('latest').value,
        notes: document.getElementById('notes').value.trim()
      };

      toast("שולח...", true);

      try{
        // אם אין לך עדיין API, אפשר להחליף בשמירה ב-localStorage
        const res = await fetch(API_URL, {
          method: "POST",
          headers: {"Content-Type":"application/json"},
          body: JSON.stringify(payload),
        });

        if(!res.ok){ throw new Error("שגיאת שרת ("+res.status+")"); }
        const data = await res.json().catch(()=>({}));

        let msg = "הבקשה נרשמה.";
        if(data.assigned) msg += " נמצא נהג מתאים!";
        if(data.matchCode) msg += " קוד התאמה: "+data.matchCode;
        if(data.next) msg += " " + data.next;

        toast(msg, true);

        // איפוס קל
        e.target.reset();
        document.getElementById('zone').value = "";
        // החזרת חלון זמן ברירת מחדל
        (function presetWindow(){
          const now = new Date();
          const latest = new Date(now.getTime() + 120*60000);
          const pad = n => String(n).padStart(2,'0');
          const toLocal = d => d.getFullYear()+"-"+pad(d.getMonth()+1)+"-"+pad(d.getDate())+"T"+pad(d.getHours())+":"+pad(d.getMinutes());
          document.getElementById('earliest').value = toLocal(now);
          document.getElementById('latest').value   = toLocal(latest);
        })();

      }catch(err){
        console.error(err);
        toast("לא ניתן לשלוח כעת. נסו שוב בעוד רגע או בדקו את החיבור.", false);
      }
    });
  </script>
</body>
</html>