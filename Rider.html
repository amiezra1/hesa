<!doctype html>
<html lang="he" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>×¨×™×©×•× × ×•×¡×¢ â€“ ×”×™×¡×¢ ×œ××™×œ×•××™×</title>
  <meta name="color-scheme" content="light">

  <style>
    :root{
      --radius:16px; 
      --border:#e2e8f0; 
      --bg:#f8fafc; 
      --text:#0f172a; 
      --muted:#64748b;
      --brand:#2563eb; 
      --brand-light:#3b82f6;
      --accent:#06b6d4; 
      --ok:#10b981; 
      --err:#ef4444;
      --card:#ffffff; 
      --shadow:0 1px 3px rgba(0,0,0,.05), 0 10px 40px rgba(0,0,0,.03);
      --shadow-lg:0 20px 60px rgba(0,0,0,.08);
    }
    *{box-sizing:border-box; margin:0; padding:0}
    html,body{height:100%}
    body{
      font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,'Helvetica Neue',Arial,sans-serif;
      margin:0;
      background:linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color:var(--text);
      line-height:1.6;
    }
    .wrap{max-width:920px; margin-inline:auto; padding:32px 20px}
    
    .header{
      border-radius:24px; 
      padding:40px 32px; 
      margin:0 0 28px;
      background:var(--card);
      border:1px solid var(--border);
      box-shadow:var(--shadow-lg);
      position:relative;
      overflow:hidden;
    }
    .header::before{
      content:'';
      position:absolute;
      top:0;
      left:0;
      right:0;
      height:4px;
      background:linear-gradient(90deg, var(--brand), var(--accent));
    }
    .badge{
      display:inline-flex; 
      gap:8px; 
      align-items:center; 
      font-size:13px; 
      font-weight:600;
      color:var(--brand); 
      background:rgba(37,99,235,0.08); 
      border:1px solid rgba(37,99,235,0.15); 
      padding:8px 16px; 
      border-radius:999px;
      margin-bottom:16px;
    }
    h1{
      margin:12px 0 12px; 
      font-size:32px; 
      font-weight:700;
      background:linear-gradient(135deg, var(--brand), var(--accent));
      -webkit-background-clip:text;
      -webkit-text-fill-color:transparent;
      background-clip:text;
    }
    .sub{
      color:var(--muted); 
      margin:0 0 20px;
      font-size:15px;
      line-height:1.7;
    }
    .kpi{
      display:flex; 
      gap:12px; 
      flex-wrap:wrap;
      align-items:center; 
      font-size:13px; 
      margin-top:20px;
    }
    .chip{
      padding:8px 14px; 
      border-radius:12px; 
      background:var(--bg); 
      border:1px solid var(--border); 
      font-size:13px;
      color:var(--muted);
      font-weight:500;
      transition:all 0.2s ease;
    }
    .chip:hover{
      background:#fff;
      box-shadow:0 2px 8px rgba(0,0,0,.06);
    }
    
    .card{
      background:var(--card); 
      border:1px solid var(--border); 
      border-radius:var(--radius); 
      padding:32px; 
      margin:20px 0;
      box-shadow:var(--shadow);
      transition:box-shadow 0.3s ease;
    }
    .card:hover{
      box-shadow:var(--shadow-lg);
    }
    
    .grid{display:grid; grid-template-columns:1fr; gap:20px}
    @media(min-width:720px){ .grid{grid-template-columns:1fr 1fr} }
    
    .row{display:flex; gap:10px; flex-wrap:wrap; align-items:center}
    
    label{
      font-size:14px; 
      font-weight:600;
      color:var(--text); 
      display:block; 
      margin-bottom:8px;
    }
    
    input,select,button,textarea{
      font:inherit; 
      padding:14px 16px; 
      border:2px solid var(--border); 
      border-radius:12px; 
      width:100%; 
      background:#fff; 
      color:var(--text);
      transition:all 0.2s ease;
      font-size:15px;
    }
    input::placeholder, textarea::placeholder{
      color:#94a3b8;
    }
    input:hover, select:hover, textarea:hover{
      border-color:#cbd5e1;
    }
    input:focus,select:focus,textarea:focus{
      outline:none; 
      border-color:var(--brand); 
      box-shadow:0 0 0 4px rgba(37,99,235,.1);
    }
    textarea{
      resize:vertical; 
      min-height:100px;
      line-height:1.6;
    }
    
    .helper{
      font-size:13px; 
      color:var(--muted); 
      margin-top:6px;
      font-style:italic;
    }
    
    button{
      cursor:pointer; 
      border:0; 
      padding:16px 32px; 
      border-radius:12px; 
      font-weight:700;
      font-size:16px;
      background:linear-gradient(135deg, var(--brand), var(--brand-light)); 
      color:#fff;
      transition:all 0.2s ease;
      box-shadow:0 4px 14px rgba(37,99,235,.3);
      text-transform:none;
    }
    button:hover{
      transform:translateY(-2px);
      box-shadow:0 6px 20px rgba(37,99,235,.4);
    }
    button:active{
      transform:translateY(0);
    }
    
    .actions{
      display:flex; 
      gap:16px; 
      flex-wrap:wrap; 
      align-items:center; 
      justify-content:flex-start;
      margin-top:24px;
    }
    
    hr{
      border:0; 
      height:1px; 
      background:var(--border); 
      margin:24px 0;
    }
    
    .status{
      min-height:1.6em;
      font-weight:600;
      font-size:15px;
    }
    .ok{color:var(--ok)}
    .err{color:var(--err)}
    .muted{color:var(--muted)}
    
    footer{
      margin:32px 0; 
      padding:24px;
      font-size:13px; 
      color:#fff; 
      text-align:center;
      background:rgba(255,255,255,0.1);
      border-radius:16px;
      backdrop-filter:blur(10px);
      line-height:1.8;
    }
    
    .info-card h3{
      margin:0 0 16px; 
      font-size:20px;
      font-weight:700;
      color:var(--text);
    }
    .info-card ol{
      margin:12px 0 16px 24px; 
      line-height:1.9;
      color:var(--muted);
    }
    .info-card ol li{
      margin-bottom:8px;
      padding-right:8px;
    }
    .tooltip{
      font-size:13px; 
      color:var(--brand);
      background:rgba(37,99,235,0.08);
      padding:12px 16px;
      border-radius:12px;
      border-right:3px solid var(--brand);
      margin-top:16px;
      font-weight:500;
    }
    
    input[type="checkbox"]{
      width:20px;
      height:20px;
      margin-left:8px;
      cursor:pointer;
      accent-color:var(--brand);
    }
    
    .privacy-row{
      display:flex;
      align-items:center;
      gap:8px;
      padding:16px;
      background:var(--bg);
      border-radius:12px;
      margin-top:20px;
    }
    .privacy-row label{
      margin:0;
      font-size:14px;
      font-weight:500;
      cursor:pointer;
    }
    
    @media(max-width:720px){
      .wrap{padding:20px 16px}
      .header{padding:28px 24px}
      h1{font-size:26px}
      .card{padding:24px}
      .kpi{gap:8px}
    }
  </style>
</head>
<body>
  <div class="wrap">

    <!-- Header -->
    <section class="header">
      <div class="badge">ğŸ¯ ×˜×•×¤×¡ ×¨×™×©×•× × ×•×¡×¢ â€¢ ×”×™×¡×¢ ×œ××™×œ×•××™×</div>
      <h1>×‘×§×©×ª × ×¡×™×¢×” â€“ × ×•×¡×¢</h1>
      <p class="sub">×‘×—×¨×• <strong>××–×•×¨ ×™×¢×“</strong> (×—×•×‘×”) ×•×”×•×¡×™×¤×• <strong>×¢×™×¨ ××“×•×™×§×ª</strong> ×¨×§ ×× × ×—×•×¥. ×”×’×“×™×¨×• ×—×œ×•×Ÿ ×–××Ÿ ×¡×‘×™×¨ ×œ×”××ª× ×”.</p>
      <div class="kpi">
        <span class="chip">âŒ› ××™×œ×•×™ ~ 30â€“45 ×©× ×™×•×ª</span>
        <span class="chip">ğŸ”’ ×¤×¨×˜×™ ×§×©×¨ × ×—×©×¤×™× ×œ××—×¨ ×”×ª×××”</span>
        <span class="chip">ğŸ•’ ×—×œ×•×Ÿ ×–××Ÿ ×‘×¨×™×¨×ª ××—×“×œ: ×¢×›×©×™×• ×¢×“ +120 ×“×§×³</span>
      </div>
    </section>

    <!-- Form -->
    <form id="riderForm" class="card" novalidate>
      <div class="grid">
        <div>
          <label for="ids">×ª×¢×•×“×ª ×–×”×•×ª *</label>
          <input id="ids" name="ids" inputmode="numeric" pattern="[0-9]*" maxlength="9" placeholder="×ª×¢×•×“×ª ×–×”×•×ª" oninput="this.value = this.value.replace(/[^0-9]/g, '')" required/>
        </div>
        <div>
          <label for="name">×©× ××œ× *</label>
          <input id="name" name="name" placeholder="×©× ×¤×¨×˜×™ ×•×©× ××©×¤×—×”" autocomplete="name" required />
        </div>
        <div>
          <label for="phone">×˜×œ×¤×•×Ÿ × ×™×™×“ (05XXXXXXXX) *</label>
          <input id="phone" name="phone" placeholder="×œ×“×•×’××”: 0521234567" autocomplete="tel" pattern="[0-9]*" inputmode="numeric" maxlength="10" oninput="this.value = this.value.replace(/[^0-9]/g, '')" required />
        </div>

        <div>
          <label for="origin">×ª×—× ×ª ××•×¦× *</label>
          <select id="origin" name="origin" required>
            <option value="">×‘×—×¨×• ×ª×—× ×ª ××•×¦×</option>
            <option>×¦×•××ª ×¦×§×œ"×’</option>
            <option>×©×“×” ×ª×™××Ÿ</option>
            <option>×‘××¨ ×©×‘×¢ ×¦×¤×•×Ÿ</option>
            <option>×¦×•××ª ×‘×™×ª ×§××”</option>
            <option>× ×‘×˜×™×</option>
            <option>××•×’×“×” 80</option>
            <option>×™×¨×•×—×</option>
            <option>×©×™×–×¤×•×Ÿ</option>
            <option>×¡×™×™×¨×™×</option>
          </select>
          <div class="helper">× ×™×ª×Ÿ ×œ×”×¨×—×™×‘ ×œ×¤×™ ×”×ª×—× ×•×ª ×©×œ×›×.</div>
        </div>

        <div>
          <label for="zone">××–×•×¨ ×™×¢×“ (×—×•×‘×”) *</label>
          <select id="zone" name="zone" required>
            <option value="">×‘×—×¨×• ××–×•×¨</option>
            <option>×¦×¤×•×Ÿ</option>
            <option>×—×™×¤×” ×•×”×§×¨×™×•×ª</option>
            <option>×¢××§ ×™×–×¨×¢××œ / ×•××“×™ ×¢×¨×”</option>
            <option>×©×¨×•×Ÿ</option>
            <option>×’×•×© ×“×Ÿ</option>
            <option>×©×¤×œ×”</option>
            <option>×™×¨×•×©×œ×™× ×•×”×¡×‘×™×‘×”</option>
            <option>×“×¨×•× ××¨×›×–×™</option>
            <option>×‘"×© ×•×”× ×’×‘ ×”×¦×¤×•× ×™</option>
            <option>×¢×¨×‘×”/×“×¨×•× ×¨×—×•×§</option>
          </select>
        </div>

        <div>
          <label for="city">×¢×™×¨ ××“×•×™×§×ª (××•×¤×¦×™×•× ×œ×™)</label>
          <input id="city" name="city" placeholder="×œ×“×•×’××”: ×—×•×œ×•×Ÿ, ×‘××¨ ×©×‘×¢..." />
          <div class="helper">××œ××• ×¨×§ ×× ×—×©×•×‘ ×œ×“×™×™×§ ×‘×ª×•×š ×”××–×•×¨.</div>
        </div>

        <div>
          <label for="earliest">×”×›×™ ××•×§×“× *</label>
          <input id="earliest" name="earliest" type="datetime-local" required />
        </div>
        <div>
          <label for="latest">×”×›×™ ×××•×—×¨ *</label>
          <input id="latest" name="latest" type="datetime-local" required />
          <div class="helper">×‘×¨×™×¨×ª ××—×“×œ: ×›×¢×ª ×¢×“ +120 ×“×§×³. × ×™×ª×Ÿ ×œ×©× ×•×ª.</div>
        </div>

        <div class="grid" style="grid-template-columns:1fr;">
          <div>
            <label for="notes">×”×¢×¨×•×ª (×¦×™×•×“, ×¡×˜×™×™×” ××¤×©×¨×™×ª, × ×’×™×©×•×ª)</label>
            <textarea id="notes" name="notes" placeholder="×œ×“×•×’××”: ×ª×™×§ ×’×“×•×œ / ××¢×“×™×£ ×¢×¦×™×¨×” ×‘×ª×—× ×ª ×¨×›×‘×ª ×—×•×œ×•×Ÿ"></textarea>
          </div>
        </div>
      </div>

      <div class="privacy-row">
        <input type="checkbox" id="privacy" required>
        <label for="privacy">×× ×™ ×××©×¨/×ª ×©××™×¨×” ×¢×œ ×¤×¨×˜×™×•×ª.</label>
      </div>

      <div class="actions">
        <button type="submit">×©×œ×™×—×ª ×‘×§×©×”</button>
        <span id="status" class="status muted"></span>
      </div>
    </form>

    <!-- Info -->
    <section class="card info-card">
      <h3>××™×š ×–×” ×¢×•×‘×“?</h3>
      <ol>
        <li>×××œ××™× ×¤×¨×˜×™× ×•×©×•×œ×—×™×.</li>
        <li>×”××¢×¨×›×ª ××—×¤×©×ª × ×”×’×™× ××ª××™××™× ×œ×¤×™ ××–×•×¨/×–××Ÿ/××§×•××•×ª ×¤× ×•×™×™×.</li>
        <li>×œ××—×¨ ×”×ª×××” ×ª×§×‘×œ×• ×§×™×©×•×¨ WhatsApp ××•×›×Ÿ ×œ×ª×™××•× ××•×œ ×”× ×”×’.</li>
      </ol>
      <div class="tooltip">ğŸ’¡ ×˜×™×¤: ×‘×—×¨×• ××–×•×¨ ×¨×—×‘; ×¢×™×¨ ×¨×§ ×× ×§×¨×™×˜×™.</div>
    </section>

    <footer>
      Â© ×”×™×¡×¢ ×œ××™×œ×•××™× â€“ ×œ×¦×•×¨×›×™ ××™×œ×•××™× | ×¤×¨×˜×™ ×§×©×¨ × ×—×©×¤×™× ×¨×§ ×œ××—×¨ ×”×ª×××”<br>
      ×œ×©××œ×•×ª × ×™×ª×Ÿ ×œ×¤× ×•×ª ×œ××•×§×“ ×”××™×œ×•××™× ×‘×˜×œ×¤×•×Ÿ 1111 ×©×œ×•×—×” 4 => 1 => 3
    </footer>
  </div>

  <script>
    /** ×©×™× ×›××Ÿ ××ª ×§×™×©×•×¨ ×”-Apps Script Web App ×©×œ×š */
    const API_URL = "YOUR_APPS_SCRIPT_WEB_APP_URL";

    /** ×§×‘×™×¢×ª ×‘×¨×™×¨×ª ××—×“×œ ×œ×—×œ×•×Ÿ ×–××Ÿ: ×¢×›×©×™×• ×¢×“ +120 ×“×§×•×ª */
    (function presetWindow(){
      const now = new Date();
      const latest = new Date(now.getTime() + 120*60000);
      const pad = n => String(n).padStart(2,'0');
      const toLocal = d => d.getFullYear()+"-"+pad(d.getMonth()+1)+"-"+pad(d.getDate())+"T"+pad(d.getHours())+":"+pad(d.getMinutes());
      document.getElementById('earliest').value = toLocal(now);
      document.getElementById('latest').value   = toLocal(latest);
    })();

    /** × ×™×¨××•×œ ×˜×œ×¤×•×Ÿ ×™×©×¨××œ×™ ×œ-972 */
    function normalizeIL(phone){
      if(!phone) return "";
      let p = (""+phone).replace(/\D/g,"");
      if(p.startsWith("0")) p = "972" + p.slice(1);
      return p;
    }

    /** ×”×•×“×¢×ª ×¡×˜×˜×•×¡ */
    function toast(msg, ok=false){
      const el = document.getElementById('status');
      el.textContent = msg;
      el.className = "status " + (ok ? "ok" : "err");
    }

    /** ×•×œ×™×“×¦×™×” ×‘×¡×™×¡×™×ª */
    function validate(){
      const required = ["name","phone","origin","zone","earliest","latest","privacy"];
      for(const id of required){
        const el = document.getElementById(id);
        if(id==="privacy"){
          if(!el.checked){ toast("×™×© ×œ××©×¨ ××ª ×ª× ××™ ×”×¤×¨×˜×™×•×ª.", false); return false; }
          continue;
        }
        if(!el || !el.value.trim()){ toast("× × ×œ××œ× ××ª ×›×œ ×”×©×“×•×ª ×”×—×™×•× ×™×™× ×”××¡×•×× ×™× *", false); return false; }
      }
      const phone = document.getElementById('phone').value.trim();
      if(!/^0?5\d{8}$/.test(phone)){ toast("×˜×œ×¤×•×Ÿ ×œ× ×ª×§×™×Ÿ. ×¤×•×¨××˜: 05XXXXXXXX", false); return false; }

      const eVal = document.getElementById('earliest').value;
      const lVal = document.getElementById('latest').value;
      const e = new Date(eVal), l = new Date(lVal);
      if(!(e instanceof Date) || !(l instanceof Date) || isNaN(e.getTime()) || isNaN(l.getTime())){
        toast("×—×œ×•×Ÿ ×–××Ÿ ×œ× ×ª×§×™×Ÿ.", false); return false;
      }
      if(l <= e){ toast("'×”×›×™ ×××•×—×¨' ×—×™×™×‘ ×œ×”×™×•×ª ××—×¨×™ '×”×›×™ ××•×§×“×'.", false); return false; }
      // ×—×œ×•×Ÿ ×¡×‘×™×¨ ×¢×“ 8 ×©×¢×•×ª (×× ×™×¢×ª ×˜×¢×•×™×•×ª)
      if((l - e) > 8*60*60000){ toast("×—×œ×•×Ÿ ×–××Ÿ ×’×“×•×œ ××“×™ (××§×¡×™××•× 8 ×©×¢×•×ª).", false); return false; }

      return true;
    }

    /** ×©×œ×™×—×ª ×˜×•×¤×¡ */
    document.getElementById('riderForm').addEventListener('submit', async (e)=>{
      e.preventDefault();
      if(!validate()) return;

      const payload = {
        role: "rider",
        name: document.getElementById('name').value.trim(),
        phone: normalizeIL(document.getElementById('phone').value.trim()),
        ids: document.getElementById('ids').value.trim(),
        origin: document.getElementById('origin').value,
        destinationZone: document.getElementById('zone').value,
        preciseCity: document.getElementById('city').value.trim(), // ××•×¤×¦×™×•× ×œ×™
        earliest: document.getElementById('earliest').value,
        latest: document.getElementById('latest').value,
        notes: document.getElementById('notes').value.trim()
      };

      toast("×©×•×œ×—...", true);

      try{
        // ×× ××™×Ÿ ×œ×š ×¢×“×™×™×Ÿ API, ××¤×©×¨ ×œ×”×—×œ×™×£ ×‘×©××™×¨×” ×‘-localStorage
        const res = await fetch(API_URL, {
          method: "POST",
          headers: {"Content-Type":"application/json"},
          body: JSON.stringify(payload),
        });

        if(!res.ok){ throw new Error("×©×’×™××ª ×©×¨×ª ("+res.status+")"); }
        const data = await res.json().catch(()=>({}));

        let msg = "×”×‘×§×©×” × ×¨×©××”.";
        if(data.assigned) msg += " × ××¦× × ×”×’ ××ª××™×!";
        if(data.matchCode) msg += " ×§×•×“ ×”×ª×××”: "+data.matchCode;
        if(data.next) msg += " " + data.next;

        toast(msg, true);

        // ××™×¤×•×¡ ×§×œ
        e.target.reset();
        document.getElementById('zone').value = "";
        // ×”×—×–×¨×ª ×—×œ×•×Ÿ ×–××Ÿ ×‘×¨×™×¨×ª ××—×“×œ
        (function presetWindow(){
          const now = new Date();
          const latest = new Date(now.getTime() + 120*60000);
          const pad = n => String(n).padStart(2,'0');
          const toLocal = d => d.getFullYear()+"-"+pad(d.getMonth()+1)+"-"+pad(d.getDate())+"T"+pad(d.getHours())+":"+pad(d.getMinutes());
          document.getElementById('earliest').value = toLocal(now);
          document.getElementById('latest').value   = toLocal(latest);
        })();

      }catch(err){
        console.error(err);
        toast("×œ× × ×™×ª×Ÿ ×œ×©×œ×•×— ×›×¢×ª. × ×¡×• ×©×•×‘ ×‘×¢×•×“ ×¨×’×¢ ××• ×‘×“×§×• ××ª ×”×—×™×‘×•×¨.", false);
      }
    });
  </script>
</body>
</html>